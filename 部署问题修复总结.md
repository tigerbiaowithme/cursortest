# éƒ¨ç½²é—®é¢˜ä¿®å¤æ€»ç»“

## ğŸ”´ é‡åˆ°çš„é—®é¢˜

### é—®é¢˜ 1ï¼špackage-lock.json ä¸åŒæ­¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
npm error Missing: yaml@2.8.2 from lock file
npm error `npm ci` can only install packages when your package.json and package-lock.json are in sync
```

**æ ¹æœ¬åŸå› ï¼š**
- `package-lock.json` æ–‡ä»¶è¿‡æ—¶
- ä¾èµ–ç‰ˆæœ¬å†²çªï¼š`yaml@1.10.2` å·²å®‰è£…ï¼Œä½† `tailwindcss` çš„ `postcss-load-config` éœ€è¦ `yaml@^2.4.2`

**è§£å†³æ–¹æ¡ˆï¼š**
1. åˆ é™¤ `node_modules` å’Œ `package-lock.json`
2. è¿è¡Œ `npm install` é‡æ–°ç”Ÿæˆ `package-lock.json`
3. æäº¤å¹¶æ¨é€åˆ° GitHub

---

### é—®é¢˜ 2ï¼šç¯å¢ƒå˜é‡é…ç½®è­¦å‘Š

**è­¦å‘Šä¿¡æ¯ï¼š**
```
âš ï¸ Build-time environment variable warning: NODE_ENV=production
Issue: Skips devDependencies installation which are often required for building
```

**æ ¹æœ¬åŸå› ï¼š**
- `NODE_ENV=production` çš„ "Available at Buildtime" è¢«å‹¾é€‰
- æ„å»ºæ—¶ `NODE_ENV=production` ä¼šå¯¼è‡´ npm è·³è¿‡ `devDependencies` å®‰è£…
- Next.js æ„å»ºéœ€è¦ `devDependencies`ï¼ˆTypeScriptã€ESLint ç­‰ï¼‰

**è§£å†³æ–¹æ¡ˆï¼š**
åœ¨ Coolify ç¯å¢ƒå˜é‡é…ç½®ä¸­ï¼š
- æ‰¾åˆ° `NODE_ENV` å˜é‡
- ç‚¹å‡» "Update"
- **å–æ¶ˆå‹¾é€‰ "Available at Buildtime"**
- **ä¿æŒå‹¾é€‰ "Available at Runtime"**
- ä¿å­˜

---

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ä¿®å¤ package-lock.json

å·²æ‰§è¡Œï¼š
```bash
# åˆ é™¤æ—§çš„ node_modules å’Œ package-lock.json
Remove-Item -Recurse -Force node_modules
Remove-Item -Force package-lock.json

# é‡æ–°å®‰è£…ä¾èµ–ï¼Œç”Ÿæˆæ–°çš„ package-lock.json
npm install

# æäº¤å¹¶æ¨é€
git add package-lock.json
git commit -m "Fix package-lock.json: regenerate to fix yaml version conflict"
git push
```

### 2. ç¯å¢ƒå˜é‡é…ç½®ä¿®å¤è¯´æ˜

éœ€è¦åœ¨ Coolify ä¸­æ‰‹åŠ¨ä¿®å¤ï¼š

1. è¿›å…¥ **Environment Variables** é¡µé¢
2. æ‰¾åˆ° `NODE_ENV` å˜é‡
3. ç‚¹å‡» **"Update"** æŒ‰é’®
4. é…ç½®ï¼š
   - Value: `production`ï¼ˆä¿æŒä¸å˜ï¼‰
   - **Available at Buildtime**: âŒ **å–æ¶ˆå‹¾é€‰**
   - **Available at Runtime**: âœ… **å‹¾é€‰**
5. ä¿å­˜

---

## ğŸ“‹ æ­£ç¡®çš„ç¯å¢ƒå˜é‡é…ç½®

| å˜é‡å | Value | Available at Buildtime | Available at Runtime |
|--------|-------|----------------------|---------------------|
| `MONGODB_URI` | `mongodb+srv://...` | âœ… å‹¾é€‰ | âœ… å‹¾é€‰ |
| `JWT_SECRET` | `your-secret-key` | âœ… å‹¾é€‰ | âœ… å‹¾é€‰ |
| `NODE_ENV` | `production` | âŒ **ä¸å‹¾é€‰** | âœ… å‹¾é€‰ |

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. ä¿®å¤ç¯å¢ƒå˜é‡é…ç½®ï¼ˆåœ¨ Coolify ä¸­ï¼‰

æŒ‰ç…§ä¸Šé¢çš„è¯´æ˜ä¿®å¤ `NODE_ENV` çš„é…ç½®ã€‚

### 2. é‡æ–°éƒ¨ç½²

ä¿®å¤ç¯å¢ƒå˜é‡åï¼Œåœ¨ Coolify ä¸­è§¦å‘æ–°çš„éƒ¨ç½²ã€‚

### 3. éªŒè¯éƒ¨ç½²

éƒ¨ç½²æˆåŠŸåï¼Œæ£€æŸ¥ï¼š
- âœ… æ„å»ºæ—¥å¿—ä¸­æ²¡æœ‰é”™è¯¯
- âœ… åº”ç”¨æ­£å¸¸å¯åŠ¨
- âœ… å¯ä»¥è®¿é—®ç½‘ç«™

---

## ğŸ’¡ ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™äº›é—®é¢˜ï¼Ÿ

### package-lock.json ä¸åŒæ­¥çš„åŸå› ï¼š

1. **ä¾èµ–æ›´æ–°**ï¼šæŸäº›ä¾èµ–åŒ…æ›´æ–°äº†ç‰ˆæœ¬è¦æ±‚
2. **æ‰‹åŠ¨ä¿®æ”¹**ï¼šå¯èƒ½æ‰‹åŠ¨ä¿®æ”¹äº† `package.json` ä½†æ²¡æœ‰è¿è¡Œ `npm install`
3. **ä¸åŒç¯å¢ƒ**ï¼šåœ¨ä¸åŒç¯å¢ƒï¼ˆå¼€å‘/ç”Ÿäº§ï¼‰ä¸­å®‰è£…ä¾èµ–å¯èƒ½å¯¼è‡´å·®å¼‚

### ç¯å¢ƒå˜é‡é…ç½®é—®é¢˜çš„åŸå› ï¼š

1. **é»˜è®¤é…ç½®**ï¼šCoolify å¯èƒ½é»˜è®¤å°†æ‰€æœ‰ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºæ„å»ºæ—¶å¯ç”¨
2. **NODE_ENV ç‰¹æ®Šè¡Œä¸º**ï¼š`NODE_ENV=production` ä¼šå½±å“ npm çš„è¡Œä¸ºï¼ˆè·³è¿‡ devDependenciesï¼‰
3. **Next.js æ„å»ºéœ€æ±‚**ï¼šNext.js æ„å»ºéœ€è¦ devDependenciesï¼ˆTypeScriptã€ESLint ç­‰ï¼‰

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Coolifyéƒ¨ç½²å®Œæ•´æŒ‡å—.md](./Coolifyéƒ¨ç½²å®Œæ•´æŒ‡å—.md)
- [Coolifyéƒ¨ç½²é—®é¢˜è§£å†³æ–¹æ¡ˆ.md](./Coolifyéƒ¨ç½²é—®é¢˜è§£å†³æ–¹æ¡ˆ.md)
- [ç¯å¢ƒå˜é‡è¯¦ç»†è¯´æ˜.md](./ç¯å¢ƒå˜é‡è¯¦ç»†è¯´æ˜.md)

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨é‡æ–°éƒ¨ç½²å‰ï¼Œç¡®ä¿ï¼š

- [x] `package-lock.json` å·²é‡æ–°ç”Ÿæˆå¹¶æ¨é€åˆ° GitHub
- [ ] `NODE_ENV` ç¯å¢ƒå˜é‡çš„ "Available at Buildtime" å·²å–æ¶ˆå‹¾é€‰
- [ ] æ‰€æœ‰ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] å‡†å¤‡è§¦å‘æ–°çš„éƒ¨ç½²

ä¿®å¤å®Œæˆåï¼Œéƒ¨ç½²åº”è¯¥èƒ½å¤ŸæˆåŠŸï¼
