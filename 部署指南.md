# GitHub + Coolify 部署指南

本指南将帮助您将项目上传到 GitHub，并配置 Coolify 自动部署。

---

## 第一部分：上传到 GitHub

### 步骤 1：初始化 Git 仓库（如果还没有）

在项目文件夹中打开终端（PowerShell 或 CMD），运行：

```bash
git init
```

### 步骤 2：添加所有文件到 Git

```bash
git add .
```

### 步骤 3：提交文件

```bash
git commit -m "Initial commit: Devos website"
```

### 步骤 4：在 GitHub 上创建新仓库

1. 登录 GitHub (https://github.com)
2. 点击右上角的 **"+"** 按钮，选择 **"New repository"**
3. 填写仓库信息：
   - **Repository name**: `devos-website`（或您喜欢的名称）
   - **Description**: `外贸独立站 - 多语言支持`
   - **Visibility**: 选择 Public 或 Private
   - **不要**勾选 "Initialize this repository with a README"（因为我们已经有文件了）
4. 点击 **"Create repository"**

### 步骤 5：连接本地仓库到 GitHub

GitHub 会显示一个页面，上面有仓库地址。复制 **HTTPS** 地址（格式：`https://github.com/你的用户名/devos-website.git`）

然后运行：

```bash
git remote add origin https://github.com/你的用户名/devos-website.git
```

（将 `你的用户名/devos-website` 替换为您实际的仓库地址）

### 步骤 6：上传到 GitHub

```bash
git branch -M main
git push -u origin main
```

如果提示输入用户名和密码：
- **用户名**：您的 GitHub 用户名
- **密码**：使用 Personal Access Token（不是 GitHub 密码）

#### 如何创建 Personal Access Token：

1. GitHub → Settings → Developer settings → Personal access tokens → Tokens (classic)
2. 点击 "Generate new token (classic)"
3. 选择权限：至少勾选 `repo` 权限
4. 生成后**立即复制**（只显示一次）
5. 在提示输入密码时，粘贴这个 Token

---

## 第二部分：配置 Coolify 自动部署

### 步骤 1：在 Coolify 中添加 GitHub 仓库

1. 登录 Coolify 控制台
2. 点击 **"New Resource"** 或 **"New Project"**
3. 选择 **"GitHub"** 作为源代码来源
4. 授权 Coolify 访问您的 GitHub 账户（如果还没有）
5. 选择仓库：`devos-website`
6. 选择分支：`main`（或 `master`）

### 步骤 2：配置构建设置

Coolify 会自动检测到这是一个 Node.js 项目。配置如下：

- **Build Pack**: Node.js（通常自动检测）
- **Node Version**: 18 或 20
- **Build Command**: `npm run build`
- **Start Command**: `npm start`
- **Port**: `3000`

### 步骤 3：配置环境变量

在 Coolify 的环境变量配置中添加：

```
MONGODB_URI=mongodb+srv://devos:你的密码@cluster0.d59flm2.mongodb.net/devos?appName=Cluster0
JWT_SECRET=your-secret-key-change-in-production-use-random-string-here
NODE_ENV=production
```

**重要提示：**
- 将 `你的密码` 替换为您的 MongoDB Atlas 密码
- `JWT_SECRET` 应该是一个随机生成的字符串（用于生产环境）
- 确保 MongoDB Atlas 允许从任何 IP 访问（Network Access → Add IP Address → 0.0.0.0/0）

### 步骤 4：启用自动部署

在 Coolify 项目设置中：

1. 找到 **"Webhooks"** 或 **"Auto Deploy"** 选项
2. 启用 **"Auto Deploy on Push"**
3. Coolify 会自动创建一个 GitHub Webhook，当您推送代码时会自动触发部署

### 步骤 5：首次部署

点击 **"Deploy"** 按钮，Coolify 会：
1. 克隆您的代码
2. 安装依赖（`npm install`）
3. 构建项目（`npm run build`）
4. 启动应用（`npm start`）

---

## 第三部分：本地修改并上传到 GitHub

### 日常开发流程

#### 1. 在本地修改代码

在您的编辑器（VS Code）中修改代码。

#### 2. 查看修改状态

```bash
git status
```

#### 3. 添加修改的文件

```bash
git add .
```

或者添加特定文件：

```bash
git add 文件名
```

#### 4. 提交修改

```bash
git commit -m "描述您的修改内容"
```

例如：
```bash
git commit -m "修复语言切换功能"
git commit -m "更新产品页面样式"
git commit -m "添加新功能：XXX"
```

#### 5. 推送到 GitHub

```bash
git push origin main
```

#### 6. Coolify 自动部署

推送成功后，Coolify 会自动：
- 检测到新的推送
- 拉取最新代码
- 重新构建和部署应用

**通常需要等待 2-5 分钟**部署完成。

---

## 常用 Git 命令参考

```bash
# 查看状态
git status

# 查看修改内容
git diff

# 添加所有修改
git add .

# 提交
git commit -m "提交说明"

# 推送到 GitHub
git push origin main

# 拉取最新代码（如果多人协作）
git pull origin main

# 查看提交历史
git log

# 创建新分支
git checkout -b 新分支名

# 切换分支
git checkout 分支名

# 合并分支
git merge 分支名
```

---

## 故障排除

### 问题 1：Git 提示需要配置用户名和邮箱

运行：

```bash
git config --global user.name "您的名字"
git config --global user.email "您的邮箱@example.com"
```

### 问题 2：推送失败（权限错误）

- 检查 GitHub 仓库地址是否正确
- 确认使用的是 Personal Access Token 而不是密码
- 重新生成 Token 并重试

### 问题 3：Coolify 部署失败

- 检查环境变量是否正确配置
- 查看 Coolify 的构建日志
- 确认 MongoDB Atlas 允许从 Coolify 服务器 IP 访问
- 检查 `package.json` 中的脚本是否正确

### 问题 4：环境变量不生效

- 在 Coolify 中修改环境变量后，需要重新部署
- 确保环境变量名称正确（区分大小写）
- 检查 `.env` 文件是否被 `.gitignore` 忽略（应该被忽略）

---

## 安全提示

✅ **应该上传到 GitHub：**
- 源代码
- 配置文件（但不包含敏感信息）
- README 文档

❌ **不应该上传到 GitHub：**
- `.env` 文件（已在 `.gitignore` 中）
- `node_modules` 文件夹（已在 `.gitignore` 中）
- 个人密码和密钥

---

## 下一步

1. ✅ 上传代码到 GitHub
2. ✅ 配置 Coolify 自动部署
3. ✅ 设置环境变量
4. ✅ 测试自动部署流程

完成这些步骤后，您就可以：
- 在本地修改代码
- 推送到 GitHub
- Coolify 自动部署最新版本

祝您部署顺利！🚀